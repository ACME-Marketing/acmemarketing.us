---
import BaseLayout from '../layouts/BaseLayout.astro'
import Hero from '../components/Hero.astro'
import HomepagePosts from '../components/HomepagePosts.astro'
import { graphQLClient, gql } from '../lib/graphql'

// GraphQL query for posts with tags "acmemarketing" or "all"
const GET_POSTS = gql`
  query GetPosts {
    posts(where: { tagSlugIn: ["acmemarketing", "all"] }) {
      nodes {
        title
        uri
        content
        featuredImage {
          node {
            sourceUrl
            altText
            mediaDetails {
              width
              height
            }
          }
        }
        tags {
          nodes {
            name
            slug
          }
        }
      }
    }
  }
`

let posts = []
try {
  const data = await graphQLClient.request(GET_POSTS)
  posts = data.posts.nodes
  console.log("Fetched posts for acmemarketing.us:", posts)
} catch (error) {
  console.error("Error fetching posts:", error)
}
---

<BaseLayout title="ACME Marketing">
  <Hero />
  <HomepagePosts posts={posts} />
</BaseLayout>
